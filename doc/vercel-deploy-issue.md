## 標題

Nuxt 3 應用部署到 Vercel 的需求與注意事項

## 摘要

希望將本專案（Nuxt 3 + @nuxtjs/i18n + Pinia 等）部署到 Vercel，並記錄部署流程、常見問題、環境設定與最佳實踐。

## 需求

- 將現有 Nuxt 3 應用部署到 Vercel
- 支援 SSR（Server Side Rendering）
- 正確處理 i18n lazy loading、語系檔案路徑
- Pinia/SSR 狀態同步
- 靜態資源（public/、assets/）正確部署
- CI/CD 自動化（可選）

## 步驟

1. **註冊 Vercel 並連接 GitHub Repo**
   - 登入 Vercel，新增專案，選擇本 repo
2. **設定 Vercel Build & Output**
   - Vercel 會自動偵測 Nuxt 3，build 指令為 `pnpm build` 或 `npm run build`
   - Output 應為 `.output` 目錄（Nuxt 3 預設）
3. **環境變數**
   - 若有 API key、第三方服務，請在 Vercel 專案設定環境變數
4. **語系檔案路徑注意**
   - `nuxt.config.ts` 的 `i18n.langDir` 路徑需與 repo 結構一致，避免 build/deploy 時找不到語系檔
   - 建議語系檔放在 repo 內且路徑固定（如 `i18n/language/`）
5. **Pinia/SSR 狀態**
   - 確保 Pinia store 為純物件，避免 SSR hydration 問題
6. **靜態資源**
   - public/ 目錄下的檔案會自動部署為靜態資源
7. **CI/CD**
   - 可設定 Vercel 的自動部署（每次 push/merge 觸發 build）
   - **型別檢查（vue-tsc）必須通過**：
     - 在 build 前執行 `pnpm vue-tsc --noEmit`，確保所有程式碼型別正確
     - Vercel build command 範例：
       ```bash
       pnpm vue-tsc --noEmit && pnpm build
       ```
   - **GitHub Actions 自動部署至 Vercel**：
     1. 在 Vercel 建立專案並連接 GitHub repo。
     2. 取得 VERCEL_TOKEN：
        - 登入 Vercel，點右上個人頭像 → Settings。
        - 左側選單點「Tokens」。
        - 點「Create」產生新的 token，複製該字串。
        - 回到 GitHub repo，進入 Settings → Secrets → Actions，新增一個名為 `VERCEL_TOKEN` 的 secret，把剛剛複製的 token 貼上。
     3. 在 workflow 加入部署步驟：
        ```yaml
            - name: Deploy to Vercel
               run: npx vercel --prod --yes --token=${{ secrets.VERCEL_TOKEN }}
        ```
     4. 建議將部署步驟放在型別檢查與 build 成功之後。
     5. 每次 push/PR 合併後，CI 會自動部署至 Vercel。

## 常見問題

- 語系檔案 lazy loading 404：請確認 `langDir` 路徑正確，且語系檔有被 commit 到 repo
- SSR hydration error（Pinia）：請確保 store state 為純物件
- 靜態資源路徑錯誤：請用 `/public/` 目錄，路徑用 `/` 開頭
- Vercel 預設 node 版本不符：可在專案根目錄加 `.nvmrc` 或在 Vercel 設定 node 版本
- Vercel CLI 部署時出現 `requires confirmation. Use option "--yes" to confirm.`：
  - 解法：在 workflow deploy 步驟加上 `--yes` 參數，例如：
    ```yaml
    - name: Deploy to Vercel
       run: npx vercel --prod --yes --token=${{ secrets.VERCEL_TOKEN }}
    ```
  - 這樣可自動確認並完成部署，不會卡在互動提示。

## 參考文件

- [Nuxt 3 官方部署教學](https://nuxt.com/docs/getting-started/deployment)
- [Vercel 官方文件](https://vercel.com/docs)
- [Nuxt 3 + Vercel 部署實例](https://nuxt.com/docs/getting-started/deployment#vercel)

## PR checklist

- [ ] 確認 `nuxt.config.ts` 的 build/output 設定
- [ ] 語系檔案路徑正確
- [ ] Pinia store 為純物件
- [ ] 靜態資源皆在 public/
- [ ] Vercel 專案環境變數設定
- [ ] 部署前通過 `pnpm vue-tsc --noEmit` 型別檢查
- [ ] CI/CD pipeline 失敗時禁止部署
- [ ] 部署後驗證 SSR/i18n/Pinia 功能

---

Generated by dev-assistant for Vercel deployment tracking.
